<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Series Data Entry</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        h2 { text-align: center; margin-bottom: 5px; }
        .user-info {
            font-size: 13px;
            color: var(--tg-theme-hint-color, #888);
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: 500;
            font-size: 14px;
        }
        input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000);
            outline: none;
        }
        input:focus { border-color: var(--tg-theme-button-color, #3390ec); }
        button {
            width: 100%;
            padding: 14px;
            margin-top: 25px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button:disabled { opacity: 0.7; cursor: not-allowed; }
    </style>
</head>
<body>

    <h2>Series မှတ်တမ်း</h2>
    <div id="userInfo" class="user-info">Loading User...</div>

    <label>Series Name</label>
    <input type="text" id="series" placeholder="ဇာတ်လမ်းနာမည်">

    <label>Episode</label>
    <input type="number" id="episode" placeholder="အပိုင်း (Eg. 1)">

    <label>Line / Note</label>
    <input type="text" id="line" placeholder="မှတ်ချက် သို့မဟုတ် စာသား">
    
    <button onclick="submitData()" id="btn">Save Data</button>

    <script>
        // Telegram App ကို Initialize လုပ်ခြင်း
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();

        const tgUser = window.Telegram.WebApp.initDataUnsafe.user;

        // User ပြသခြင်း
        if (tgUser) {
            document.getElementById("userInfo").innerText = 
                `User: ${tgUser.first_name} (@${tgUser.username || "NoUsername"})`;
        } else {
            document.getElementById("userInfo").innerText = "User Info: Not Detected (Local Test)";
        }

        function submitData() {
            var series = document.getElementById("series").value;
            var episode = document.getElementById("episode").value;
            var line = document.getElementById("line").value;
            var btn = document.getElementById("btn");

            // ⚠️ အောက်ပါနေရာမှာ သင့် Google Apps Script URL ကို မဖြစ်မနေ ထည့်ပါ ⚠️
            var scriptURL = "https://script.google.com/macros/s/AKfycbzT7hgWV9WiTfMpXsyRh6tRO4wczCCKL7B5SRRkwwm2CIeeylQjFcC1MGLYaoBxiYU/exec";

            // စစ်ဆေးခြင်း
            if (!series || !episode || !line) {
                window.Telegram.WebApp.showAlert("ကျေးဇူးပြု၍ အကွက်အားလုံးကို ဖြည့်ပေးပါ။");
                return;
            }

            if (scriptURL === "YOUR_WEB_APP_URL_HERE") {
                alert("Error: Script URL ထည့်ရန် မေ့နေပါသည်။");
                return;
            }

            btn.innerText = "Saving...";
            btn.disabled = true;

            // Data ပြင်ဆင်ခြင်း (Form Data နည်းလမ်း)
            var formData = new URLSearchParams();
            formData.append("series", series);
            formData.append("episode", episode);
            formData.append("line", line);
            formData.append("username", tgUser ? tgUser.username : "N/A");
            formData.append("userid", tgUser ? tgUser.id : "N/A");

            // Google Sheet သို့ ပို့ခြင်း
            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                window.Telegram.WebApp.showAlert("အောင်မြင်ပါသည်။ Data သိမ်းပြီးပါပြီ။");
                
                // Form ပြန်ရှင်းခြင်း
                document.getElementById("series").value = "";
                document.getElementById("episode").value = "";
                document.getElementById("line").value = "";
                
                btn.innerText = "Save Data";
                btn.disabled = false;
            })
            .catch(error => {
                window.Telegram.WebApp.showAlert("Error: " + error);
                btn.innerText = "Save Data";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>